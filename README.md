# Signaling Server

## ✔️ 프로젝트 소개
```
WebRTC를 이용해 다자간 P2P 통신을 하기에 앞서 종단 간의 정보 전달을 위한 `시그널링 서버`를 구현합니다.

프로젝트는 강사와 학생 그리고 강사의 강좌와 이 강좌를 수강하는 학생으로 간단하게 엔티티를 구성하였습니다.
강사는 강좌를 개설할 수 있으며, 강사는 강좌 종료일까지 라이브 강의를 통해 학생들에게 강의를 진행합니다. 
또한, 해당 라이브는 해당 강의를 수강하는 학생들만 입장할 수 있습니다. 
학생은 라이브 시작 전과 후에 라이브 방에 입장할 수 있습니다.

WebRTC를 이용해 다자간 영상 통화를 가능하게 하는 다양한 라이브러리들이 존재합니다.(OpenVidu 등) 
하지만, 라이브 강의라는 시나리오를 통해 직접 시그널링 서버를 구축해 보고자 프로젝트를 진행하게 되었습니다.
```
## ✔️ 프로젝트 목표
- 다자간 영상 통화를 위한 시그널링 서버를 구축하는 것이 목표입니다.
- 객체 지향의 원리와 적절한 디자인 패턴을 활용한 `좋은 설계`를 하는 것이 목표입니다.
- 서비스 로직 구현시, `테스트 코드 작성`에 높은 우선 순위를 두고자 했고, 유닛 테스트 과정에서 멀티 스레드를 이용하여 데이터의 `무결성 및 정합성 보장`을 확인하는 것을 목표로 합니다.

## ✔️ 프로젝트 서버 구조
<img width="722" alt="image" src="https://user-images.githubusercontent.com/32871201/154042568-f0e66509-4c8b-4985-81fa-c88921ada8a2.png">

## ✔️ 라이브 강의 시작/입장 Call Flow
<img width="637" alt="image" src="https://user-images.githubusercontent.com/32871201/154230729-3758cead-5490-40d8-b032-7a3571035295.png">

## ✔️ WebRTC 동작 구성도
<img width="912" alt="image" src="https://user-images.githubusercontent.com/32871201/154042921-c5dffad7-1c2a-47d5-a803-953970202e4c.png">

<자료> Mozilla, WebRTC 프로토콜 소개, MDN Web Docs, Mozilla, Mar. 2021.
## ✔️ 기술적 Issue 해결 과정
- [대기실 입장과 라이브 강의 시작 메서드 간 동기화 해야 하는 문제(2개의 메서든 간 동기화가 필요)](https://zmfl1230.notion.site/ff7c97f87ae3413d8fcd7f4402e1e749)
- [테스트와 테스트 내 생성한 스레드 간 트랜잭션이 공유되지 않는 문제 - 통합 테스트 과정에서 발생한 이슈 부검](https://www.notion.so/zmfl1230/d12d9000617c46a19542d28e9d2e3b56)
- [강의가 개설되기 전, 미리 수강생이 라이브 진행 페이지에 들어와 머물러 있는 문제 - 일정 기간 새로고침을 해주지 않는다면 라이브 강의에 입장할 수 없음](https://zmfl1230.notion.site/86b9219bf3f14e0a809bf864523eef81)


## ✔️ 프로젝트 중점 사항
- 올바른 커밋 내용 관리(커밋 메세지를 통해 어떤 내용을 커밋했는지 유추 가능)
- 스프링, JPA, 데이터베이스에 종속되지 않는 독립적인 유닛 테스트 작성
- 멀티 스레드를 이용한 유닛테스트를 통해 동기화가 필요한 메서드들에 대해 데이터의 무결성과 정합성이 지켜지는지 확인
- Repository(H2, Redis, 동기화 컬레션 오브젝트(ConcurrentMap)) 추상화를 통한 환경에 따라 손쉽게 의존관계 변경 가능(유연한 DI 구현)
- Redis를 이용한 현재 진행 중인 강의 세션 관리
- 서비스 계층에서 스프링의 @Transactional를 이용하여 트랜잭션의 원자성 보장
- 동기화가 필요한 메서드들에 대해 템플릿/콜백 디자인 패턴을 적용하여 동기화 실현
